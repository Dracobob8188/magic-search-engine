#!/usr/bin/env ruby

require_relative "../lib/card_database"

class TestOrder
  def initialize
    json_path = Pathname(__dir__) + "../data/index.json"
    @db = CardDatabase.load(json_path)
  end

  def call
    @db.sets.each do |set_code, set|
      printings = set.printings.sort_by{|n| [n.number.to_i, n.number] }
      printings.each_cons(2) do |a, b|
        if (order_key(a) <=> order_key(b)) == 1
          puts "#{set_code} #{a.name} #{b.name}"
        end
      end
    end
  end

  def order_key(card)
    # 1809 order violations
    [
      card.colors == "w" ? 0 : 1,
      card.colors == "u" ? 0 : 1,
      card.colors == "b" ? 0 : 1,
      card.colors == "r" ? 0 : 1,
      card.colors == "g" ? 0 : 1,
      card.colors == ""  ? 1 : 0,
      card.types.include?("land") ? 1 : 0,
      card.types.include?("basic") ? 1 : 0,
      card.name == "Plains" ? 0 : 1,
      card.name == "Island" ? 0 : 1,
      card.name == "Swamp" ? 0 : 1,
      card.name == "Mountain" ? 0 : 1,
      card.name == "Forest" ? 0 : 1,
      card.name.downcase.gsub(/[,' ]+/, " "),
    ]
  end
end

TestOrder.new.call
